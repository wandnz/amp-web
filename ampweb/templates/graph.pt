<div metal:define-macro="body">
    <script>
        /* Sets up variables initially */
        $(document).ready(function() {

            /* Solves problem of no slash on the end of the url */
                /* Only a problem with Hashbangs */

            if ($(location).attr("href").slice(-5) == "graph") {
                window.location = "/graph/";
            }

            var urlparts = [];
            var isHashbang = false;
            
            /* Split URL into parts */
            urlparts = $(location).attr('href').toString().replace("#", "").split("graph")[1].split("/");
            
            /* Remove leading blank */
            urlparts.splice(0, 1);
    
            /* Add blanks to the end of the array to cover missing url parts */
            for (var i = 0; i < 7; i++) {
                urlparts.push("");
            }
            
            /* Set Variables */
            source = urlparts[0];
            dest = urlparts[1];
            graph = urlparts[2];
            if (urlparts[3] == "") {
                endtime = Math.round((new Date()).getTime() / 1000)
            }
            else { 
                endtime = urlparts[3];
            }
            if (urlparts[4] == "") {
                starttime = endtime - (24 * 60 * 60)
            }
            else {
                starttime = urlparts[4] ;
            }

            /* Update page variables, and draw graph */
            updateVars();
            updatePage();
            if (dest != "" || dest != undefined) {
                changeGraph({graph: graph});
            }

            sortSource();
            sortDest();          
        });

        /* Get's history.js running */
        (function(window,undefined) {
            /* Prepare */
            var History = window.History; 
            if (!History.enabled) {
                 /*
                  * History.js is disabled for this browser.
                  * This is because we can optionally choose to support HTML4 browsers or not.
                  */
                return false;
            }

            /* Bind to StateChange Event */
            History.Adapter.bind(window,'statechange',function() { 
                var State = History.getState(); 
                History.log(State.data, State.title, State.url);
            });
        })(window);
    </script>
    <div id="choices">
        <h4 onClick="backToMatrix()" style="cursor: pointer;"><< Back to Matrix</h4>
        Display From:
        <select id="drpSource" name="source" onChange="pageUpdate(this); changeGraph();" >
            <option value="--SELECT--">--SELECT--</option>
            <option tal:repeat="item sources" value="${item['name']}" tal:attributes="selected '' if item['selected'] == True else None">${item['name']}</option>
        </select>
        to:
        <select id="drpDest" name="dest" onChange="pageUpdate(this); changeGraph({graph: 'latency'});" tal:attributes="disabled '' if enabledest == False else None">          
            <option value="--SELECT--">--SELECT--</option>
            <option tal:repeat="item destinations" value="${item['name']}" tal:attributes="selected '' if item['selected'] == True else None">${item['name']}</option>
        </select>
    </div>

    <table>
        <tr>
            <td class="align-top">
                <div id="graph">Graph Goes Here</div>
            </td>
            <td class="align-top">
                <ul id="icons">
                    <li id="latency" class="icon" onclick="changeGraph({graph: 'latency'}) "><span id="sparklineLatency"></span><br>Latency</li>
                        <br>
                    <li id="jitter" class="icon" onclick="changeGraph({graph: 'jitter'})"><span id="sparklineJitter"></span><br>Jitter</li>
                        <br>
                    <li id="loss" class="icon" onclick="changeGraph({graph: 'loss'})"><span id="sparklineLoss"></span><br>Loss</li>
                        <br>
                    <li id="path" class="icon" onclick="changeGraph({graph: 'path'})"><span id="sparklinePath"></span><br>Path Analysis</li>
                </ul>
            </td>
        </tr>
    </table>
</div>
