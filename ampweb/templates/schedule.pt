<!-- macro to print a mesh or site name and link it appropriately -->
<div tal:omit-tag="" metal:define-macro="print_schedule_targets">
    <tal:block tal:repeat="target (item.dest_site + item.dest_mesh)">
        <tal:block tal:condition="target in item.dest_mesh">
            <a href="">${target}</a>
        </tal:block>

        <tal:block tal:condition="target in item.dest_site">
            ${target}
        </tal:block>

        <tal:block tal:condition="not repeat.target.end">
        ,
        </tal:block>
    </tal:block>
</div>


<!-- macro to print a single scheduled test -->
<div tal:omit-tag="" metal:define-macro="print_schedule_item_row">

<tr class="schedule-${item.test}">
    <!-- Edit button -->
    <td>
        <button class="btn btn-xs" data-toggle="modal" data-target="#modal-foo" href="/schedule/modify/${item.sourcename}/${item.id}">
            <span class="glyphicon glyphicon-pencil"></span>
        </button>
    </td>

    <!-- Test type and arguments -->
    <td data-toggle="collapse" data-target=".collapse${item.id}">
        <b>${item.test}</b>
        <!--<div class="collapse${item.id} collapse schedule-info">${item.args}</div>-->
        <div class="collapse${item.id} collapse schedule-info">
            <tal:block tal:repeat="arg item.fullargs">
                <div>${arg}</div>
            </tal:block>
        </div>
    </td>

    <!-- Test frequency -->
    <td data-toggle="collapse" data-target=".collapse${item.id}">
        ${item.frequency}
    </td>

    <!-- Test period limitations -->
    <td data-toggle="collapse" data-target=".collapse${item.id}">
        <tal:block tal:condition="len(item.period) == 0 or item.period.startswith('Starting from')">
        Continuous
        </tal:block>
        <tal:block tal:condition="len(item.period) > 0 and not item.period.startswith('Starting from')">
        Limited
        </tal:block>
        <div class="collapse${item.id} collapse schedule-info">
            ${"%s" % item.period if len(item.period) > 0 else ""}
        </div>
    </td>

    <!-- Test targets, in brief and in full -->
    <td data-toggle="collapse" data-target=".collapse${item.id}">
        <!-- brief list of targets, for the top level display -->

        <!-- if there are only a few targets then display them all -->
        <tal:block tal:condition="len(item.dest_site)+len(item.dest_mesh) <= 3">
            <div metal:use-macro="macros.print_schedule_targets"></div>
        </tal:block>

        <!-- if there are more then just print counts of targets -->
        <tal:block tal:condition="len(item.dest_site)+len(item.dest_mesh) > 3">
            <tal:block tal:condition="len(item.dest_site) > 0">
                ${len(item.dest_site)}
                <tal:block tal:condition="len(item.dest_site) == 1">
                    site
                </tal:block>
                <tal:block tal:condition="len(item.dest_site) > 1">
                    sites
                </tal:block>
            </tal:block>

            <tal:block tal:condition="len(item.dest_mesh) > 0">
                ${len(item.dest_mesh)}
                <tal:block tal:condition="len(item.dest_mesh) == 1">
                    mesh
                </tal:block>
                <tal:block tal:condition="len(item.dest_mesh) > 1">
                    meshes
                </tal:block>
            </tal:block>

            <!-- full list of targets, for the detailed display -->
            <div class="collapse${item.id} collapse schedule-info">
                <div metal:use-macro="macros.print_schedule_targets"></div>
            </div>
        </tal:block>
    </td>

    <!-- Was this schedule item inherited through mesh membership -->
    <td data-toggle="collapse" data-target=".collapse${item.id}">
        <tal:block tal:condition="ampname != item.sourcename">
            <a href="/schedule/view/${item.sourcename}">${item.sourcename}</a>
        </tal:block>
    </td>
</tr>
</div>





<div id="content" metal:define-macro="body">

    <div id="schedule">
        <h2>
        Test Schedule for ${fullname} (${ampname})
        </h2>
    </div>

    <p><a href="/schedule">&lt;&lt; Back to schedules</a></p>

    <table class="table table-condensed table-hover">
    <thead>
        <tr>
            <th class="col-md-1"></th>
            <th class="col-md-2">Test</th>
            <th class="col-md-1">Frequency</th>
            <th class="col-md-2">Period</th>
            <th class="col-md-6">Target</th>
            <th class="col-md-1">Inherited</th>
        </tr>
    </thead>

    <tbody>
        <!-- list all schedules -->
        <div tal:repeat="item schedule">
            <div metal:use-macro="macros.print_schedule_item_row"></div>
        </div>
    </tbody>
    </table>

    <br />

    <button class="btn btn-primary btn-lg" data-toggle="modal" data-target="#modal-foo" href="/schedule/add/${ampname}">
      Schedule new test
    </button>

    <p>
    <a href="/schedule/yaml/${ampname}">View raw schedule as yaml</a>
    </p>

<script type="text/javascript">
    /* remove the data in the modal to force it to be reloaded each time */
    $("#modal-foo").on("hide.bs.modal", function(e) {
        $(this).removeData("bs.modal").find(".modal-content").empty();
    });
</script>

</div> <!-- content -->


