<!-- macro to print a single scheduled test -->
<div tal:omit-tag="" metal:define-macro="print_schedule_item_row">

<tr class="schedule-${item.test}">
    <!-- Edit button -->
    <td>
        <button class="btn btn-xs" data-toggle="modal" data-target="#modal-foo" href="/schedule/modify/${item.sourcename}/${item.id}">
            <span class="glyphicon glyphicon-pencil"></span>
        </button>
    </td>

    <!-- Test type and arguments -->
    <td data-toggle="collapse" data-target=".collapse${item.id}">
        <b>${item.test}</b>
        <!--<div class="collapse${item.id} collapse schedule-info">${item.args}</div>-->
        <div class="collapse${item.id} collapse schedule-info">
            <tal:block tal:repeat="arg item.fullargs">
                <div>${arg}</div>
            </tal:block>
        </div>
    </td>

    <!-- Test frequency -->
    <td data-toggle="collapse" data-target=".collapse${item.id}">
        ${item.frequency}
    </td>

    <!-- Test period limitations -->
    <td data-toggle="collapse" data-target=".collapse${item.id}">
        <tal:block tal:condition="len(item.period) == 0">
        Continuous
        </tal:block>
        <tal:block tal:condition="len(item.period) > 0">
        Limited
        </tal:block>
        <div class="collapse${item.id} collapse schedule-info">
            ${"%s" % item.period if len(item.period) > 0 else ""}
        </div>
    </td>

    <!-- Test targets, in brief and in full -->
    <td data-toggle="collapse" data-target=".collapse${item.id}">
        <!-- brief list of targets, for the top level display -->
        <tal:block tal:condition="len(item.dest_site)+len(item.dest_mesh) == 1">
            <tal:block tal:condition="len(item.dest_site) > 0">
                ${item.dest_site[0]}
            </tal:block>
            <tal:block tal:condition="len(item.dest_mesh) > 0">
                ${item.dest_mesh[0]}
            </tal:block>
        </tal:block>
        <tal:block tal:condition="len(item.dest_site)+len(item.dest_mesh) > 1">
            <tal:block tal:condition="len(item.dest_site) > 0">
                ${item.dest_site[0]} (+${len(item.dest_site)} sites)
            </tal:block>
            <tal:block tal:condition="len(item.dest_mesh) > 0">
                ${item.dest_mesh[0]} (+${len(item.dest_mesh)} meshes)
            </tal:block>
        </tal:block>

        <!-- full list of targets, for the detailed display -->
        <div class="collapse${item.id} collapse schedule-info">
            <div>
            <tal:block tal:condition="len(item.dest_site) > 1">
                <b>Sites:</b>
                <tal:block tal:repeat="site item.dest_site">
                    ${site}
                </tal:block>
            </tal:block>
            </div>
            <div>
            <tal:block tal:condition="len(item.dest_mesh) > 1">
                <b>Meshes:</b>
                <tal:block tal:repeat="mesh item.dest_mesh">
                    ${mesh}
                </tal:block>
            </tal:block>
            </div>
        </div>
    </td>

    <!-- Was this schedule item inherited through mesh membership -->
    <td data-toggle="collapse" data-target=".collapse${item.id}">
        <tal:block tal:condition="ampname != item.sourcename">
            <a href="/schedule/view/${item.sourcename}">${item.sourcename}</a>
        </tal:block>
    </td>
</tr>
</div>





<div id="content" metal:define-macro="body">

    <div id="schedule">
        <h2>
        Test Schedule for ${fullname} (${ampname})
        </h2>
    </div>

    <p><a href="/schedule">&lt;&lt; Back to schedules</a></p>

    <table class="table table-condensed table-hover">
    <thead>
        <tr>
            <th class="col-md-1"></th>
            <th class="col-md-2">Test</th>
            <th class="col-md-1">Frequency</th>
            <th class="col-md-2">Period</th>
            <th class="col-md-6">Targets</th>
            <th class="col-md-1">Inherited</th>
        </tr>
    </thead>

    <tbody>
        <!-- list all schedules -->
        <div tal:repeat="item schedule">
            <div metal:use-macro="macros.print_schedule_item_row"></div>
        </div>
    </tbody>
    </table>

    <br />

    <button class="btn btn-primary btn-lg" data-toggle="modal" data-target="#modal-foo" href="/schedule/add/${ampname}">
      Schedule new test
    </button>

    <p>
    <a href="/schedule/yaml/${ampname}">View raw schedule as yaml</a>
    </p>

<script type="text/javascript">
    $(function () {
        $(".destinationtips").tooltip({
            placement:"top",
            delay: {show:250, hide:100},
        });
    });

    /* remove the data in the modal to force it to be reloaded each time */
    $("#modal-foo").on("hide.bs.modal", function(e) {
        $(this).removeData("bs.modal").find(".modal-content").empty();
    });
</script>

</div> <!-- content -->


