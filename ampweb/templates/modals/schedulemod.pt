<div class="modal-dialog">
    <div class="modal-content">
        <div class="modal-header">
            <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
            <h4 class="modal-title">Modify scheduled test</h4>
        </div>

        <div class="modal-body">


<form class="form-horizontal" role="form">
        <!-- the current site and all groups it belongs to -->
        <div class="form-group">
            <label for="source" class="col-lg-3 control-label">
                Source
            </label>
            <div class="col-lg-9">
                <p class="form-control-static">${ampname}</p>
            </div>
        </div>



        <!-- TEST OPTIONS - can we split these into other templates? -->
        <div class="form-group" style="border-top: 1px solid #e5e5e5;" id="test_options">
                &nbsp;

            <div class="form-group">
                <label for="test" class="col-lg-3 control-label">
                   Test Type
                </label>
                <div class="col-lg-8">
                    <select class="form-control" id="test" onchange="updateTestOptions(this.value)">
                        <option value="icmp" tal:attributes="selected schedule.test=='icmp'">ICMP Latency</option>
                        <option value="tcpping" tal:attributes="selected schedule.test=='tcpping'">TCP Latency</option>
                        <option value="dns" tal:attributes="selected schedule.test=='dns'">UDP DNS Latency</option>
                        <option value="traceroute" tal:attributes="selected schedule.test=='traceroute'">UDP Traceroute</option>
                        <option value="throughput" tal:attributes="selected schedule.test=='throughput'">TCP Throughput</option>
                        <option value="http" tal:attributes="selected schedule.test=='http'">HTTP</option>
                    </select>
                </div>
            </div>

            <!-- PACKET SIZE -->
            <div class="form-group" id="packet_size_block">
                <label for="packet_size" class="col-lg-3 control-label">
                    Packet Size
                </label>
                <div class="col-lg-2">
                    <input type=text class="form-control" id="packet_size" value=84 />
                </div>
                <div class="col-lg-2">
                    <p class="form-control-static">bytes</p>
                </div>
            </div>

            <!-- PORT NUMBER -->
            <div class="form-group" id="port_number_block">
                <label for="port" class="col-lg-3 control-label">
                    Port Number
                </label>
                <div class="col-lg-2">
                    <input type=text class="form-control" id="port_number" value=80 />
                </div>
            </div>

            <!-- IP PATH -->
            <div class="form-group" id="ip_path_block">
                <label for="ip_path" class="col-lg-3 control-label">
                  Report IP Path
                </label>
                <div class="col-lg-9 btn-group" data-toggle="buttons">
                    <!--
                        true and false are switched here, cause the flag is
                        used to turn it off, but it makes more sense to ask if
                        you want it on
                     -->
                    <label class="btn btn-primary active">
                        <input type="radio" name="ip_path" value="false" checked>
                        Yes
                    </label>
                    <label class="btn btn-primary">
                        <input type="radio" name="ip_path" value="true">
                        No
                    </label>
                </div>
            </div>

            <!-- AS PATH -->
            <div class="form-group" id="asn_path_block">
                <label for="asn_path" class="col-lg-3 control-label">
                  Report AS Path
                </label>
                <div class="col-lg-9 btn-group" data-toggle="buttons">
                    <label class="btn btn-primary active">
                        <input type="radio" name="asn_path" value="true" checked>
                        Yes
                    </label>
                    <label class="btn btn-primary">
                        <input type="radio" name="asn_path" value="false">
                        No
                    </label>
                </div>
            </div>

            <!-- DNS QUERY -->
            <div class="form-group" id="dns_query_block">
                <label for="dns_query" class="col-lg-3 control-label">
                    Query
                </label>
                <div class="col-lg-8">
                    <input type=text class="form-control" id="dns_query" value="www.example.org" />
                </div>
            </div>

            <!-- DNS CLASS -->
            <div class="form-group" id="dns_class_block">
                <label for="dns_class" class="col-lg-3 control-label">
                   Class
                </label>
                <div class="col-lg-8">
                    <select class="form-control" id="dns_class">
                        <option value="in">IN</option>
                    </select>
                </div>
            </div>

            <!-- DNS TYPE -->
            <div class="form-group" id="dns_type_block">
                <label for="dns_type" class="col-lg-3 control-label">
                   Type
                </label>
                <div class="col-lg-8">
                    <select class="form-control" id="dns_type">
                        <option value="a">A</option>
                        <option value="aaaa">AAAA</option>
                        <option value="ns">NS</option>
                        <option value="soa">PTR</option>
                        <option value="soa">SOA</option>
                        <option value="txt">TXT</option>
                    </select>
                </div>
            </div>

            <!-- PAYLOAD SIZE -->
            <div class="form-group" id="payload_size_block">
                <label for="payload_size" class="col-lg-3 control-label">
                    Payload Size
                </label>
                <div class="col-lg-2">
                    <input type=text class="form-control" id="payload_size" value=4096 />
                </div>
                <div class="col-lg-2">
                    <p class="form-control-static">bytes</p>
                </div>
            </div>

            <!-- RECURSION -->
            <div class="form-group" id="recursion_block">
                <label for="recursion" class="col-lg-3 control-label">
                  Recursion
                </label>
                <div class="col-lg-9 btn-group" data-toggle="buttons">
                    <label class="btn btn-primary active"
                        title="Perform a recursive query (set the Recursion Desired bit to 1)">
                        <input type="radio" name="recursion" value="true" checked>
                        Yes
                    </label>
                    <label class="btn btn-primary"
                        title="Perform a non-recursive query (set the Recursion Desired bit to 0)">
                        <input type="radio" name="recursion" value="false">
                        No
                    </label>
                </div>
            </div>


            <!-- DNSSEC -->
            <div class="form-group" id="dnssec_block">
                <label for="dnssec" class="col-lg-3 control-label">
                  DNSSEC
                </label>
                <div class="col-lg-9 btn-group" data-toggle="buttons">
                    <label class="btn btn-primary">
                        <input type="radio" name="dnssec" value="true">
                        Yes
                    </label>
                    <label class="btn btn-primary active">
                        <input type="radio" name="dnssec" value="false" checked>
                        No
                    </label>
                </div>
            </div>

            <!-- NSID -->
            <div class="form-group" id="nsid_block">
                <label for="nsid" class="col-lg-3 control-label">
                  NSID
                </label>
                <div class="col-lg-9 btn-group" data-toggle="buttons">
                    <label class="btn btn-primary">
                        <input type="radio" name="nsid" value="true">
                        Yes
                    </label>
                    <label class="btn btn-primary active">
                        <input type="radio" name="nsid" value="false" checked>
                        No
                    </label>
                </div>
            </div>

        </div>


        <!-- SCHEDULE OPTIONS -->
        <div class="form-group" style="border-top: 1px solid #e5e5e5;">
        </div>

        <div class="form-group">
            <label for="frequency_count" class="col-lg-3 control-label">
                Frequency
            </label>
            <div class="col-lg-2">
                <p class="form-control-static">Every</p>
            </div>
            <div class="col-lg-2">
                <input type=text class="form-control" id="frequency_count" value=${schedule.frequency} />
            </div>
            <div class="col-lg-3">
                <select class="form-control" id="frequency_type">
                    <option>seconds</option>
                    <option>minutes</option>
                    <option>hours</option>
                    <option>days</option>
                </select>
            </div>
        </div>

        <div class="form-group">
            <label for="duration" class="col-lg-3 control-label">
                Run Test
            </label>

            <div class="col-lg-7">
                <div class="radio">
                    <label>
                        <input type="radio" name="duration" id="continuous" value="continuous" onclick="updateTimeOptions(this.value)" checked>
                            Continuously
                        </input>
                    </label>
                </div>
                <div class="radio">
                    <label>
                        <input type="radio" name="duration" id="start" value="start" onclick="updateTimeOptions(this.value)">
                            Continuously, from a specified start time
                        </input>
                    </label>
                </div>
                <div class="radio">
                    <label>
                        <input type="radio" name="duration" id="period" value="period" onclick="updateTimeOptions(this.value)">
                            Only during a specified period
                        </input>
                    </label>
                </div>
            </div>
        </div>

        <div class="form-group" id="start_block">
            <label for="foo" class="col-lg-3 control-label">
               Start
            </label>
            <div class="col-lg-4">
                <div class='input-group date' id='datetimepicker_start'>
                    <input type='text' class="form-control" data-date-format="HH:mm:ss" />
                    <span class="input-group-addon"><span class="glyphicon glyphicon-time"></span>
                    </span>
                </div>
            </div>
            <div class="col-lg-3">
                <select class="form-control" id="startday" onchange="updateDayOptions(this.id, this.value)">
                    <option value="all">every day</option>
                    <option>Monday</option>
                    <option>Tuesday</option>
                    <option>Wednesday</option>
                    <option>Thursday</option>
                    <option>Friday</option>
                    <option>Saturday</option>
                    <option>Sunday</option>
                </select>
            </div>
        </div>

        <div class="form-group" id="end_block">
            <label for="foo" class="col-lg-3 control-label">
               End
            </label>
            <div class="col-lg-4">
                <div class='input-group date' id='datetimepicker_end'>
                    <input type='text' class="form-control" data-date-format="HH:mm:ss" />
                    <span class="input-group-addon"><span class="glyphicon glyphicon-time"></span>
                    </span>
                </div>
            </div>
            <div class="col-lg-3">
                <select class="form-control" id="endday" onchange="updateDayOptions(this.id, this.value)">
                    <option value="all">every day</option>
                    <option>Monday</option>
                    <option>Tuesday</option>
                    <option>Wednesday</option>
                    <option>Thursday</option>
                    <option>Friday</option>
                    <option>Saturday</option>
                    <option>Sunday</option>
                </select>
            </div>
        </div>


        <!-- CURRENT DESTINATIONS -->
        <div class="form-group" style="border-top: 1px solid #e5e5e5;">
        </div>

        <div class="form-group" id="destination_block">
            <label class="col-lg-3 control-label">
               Destinations
            </label>
            <div class="col-lg-7" id="target_area">
                <p class="form-control-static" tal:repeat="mesh schedule.dest_mesh">
                    <span class="glyphicon glyphicon-remove" onclick="toggleRemoveDestination('${mesh}');"></span>
                    <span name="${mesh}">&nbsp;${mesh}</span>
                </p>
                <p class="form-control-static" tal:repeat="site schedule.dest_site">
                    <span class="glyphicon glyphicon-remove" onclick="toggleRemoveDestination('${site}');"></span>
                    <span name="${site}">&nbsp;${site}</span>
                </p>
            </div>
        </div>


        <!-- destination meshes as well as individuals -->
        <!-- type in destinations as well as select boxes -->
        <div class="form-group">
            <label for="destination" class="col-lg-3 control-label">
                Add Destination
            </label>
            <div class="col-lg-8">
                <div class="radio">
                    <label>
                        <input type="radio" name="dest_type" value="destitem" checked onclick="updateDestinations(this.value)">
                        </input>
                    </label>
                    <select class="form-control" id="destitem" onclick="updateDestinations(this.id)">
                        <option disabled selected>Select destination...</option>
                        <optgroup label="Single Destination">
                        <option tal:repeat="target single_targets" value=${target.ampname} >${target.longname} (${target.ampname})</option>
                        <optgroup label="Multiple Destination">
                        <option tal:repeat="target mesh_targets" value=${target.name} >${target.longname}</option>
                    </select>
                </div>
                <div class="radio">
                    <label>
                        <input type="radio" name="dest_type" value="deststring" onclick="updateDestinations(this.value)">
                        </input>
                    </label>
                    <input type=text class="form-control" id="deststring" value="www.example.org" onclick="updateDestinations(this.id)" onchange="updateAddButtonState();" onkeyup="this.onchange();" onpaste="this.onchange();" oninput="this.onchange();" />
                </div>
            </div>
        </div>

        <div class="form-group">
            <label for="destination" class="col-lg-3 control-label">
            </label>
            <div class="col-lg-8">
                <div>
                    <button type="button" id="add" class="btn btn-sm btn-primary navbar-left" onclick="addDestination();" disabled>Add destination</button>
                </div>
            </div>
        </div>

</form>


        </div>

        <div class="modal-footer">
            <button type="button" id="delete" class="btn btn-danger navbar-left" onclick="del(${schedule.id});">Delete test</button>
            <button type="button" class="btn btn-default" data-dismiss="modal">
                Discard changes
            </button>
            <button type="button" id="submit" class="btn btn-primary" onclick="submit(${schedule.id});">Update test</button>
        </div>
    </div><!-- /.modal-content -->
</div><!-- /.modal-dialog -->


<script type="text/javascript">

    $(function () {
        var start = ${schedule.start};
        var end = ${schedule.end};
        var period = ${schedule.period};
        var startm = moment().startOf("week").add(start, "seconds");
        var endm = moment().startOf("week").add(end, "seconds");

        ampname = "${ampname}";
        destination_meshes = ${schedule.dest_mesh};
        destination_sites = ${schedule.dest_site};
        schedule_args = "${schedule.args}";
        schedule_id = ${schedule.id};

        $('#datetimepicker_start').datetimepicker({
            pickDate: false,
            defaultDate: startm.format("HH:mm:ss"),
            useSeconds: true
        });

        $('#datetimepicker_end').datetimepicker({
            pickDate: false,
            defaultDate: endm.format("HH:mm:ss"),
            useSeconds: true
        });

        updateTestOptions($("#test option:selected").val());

        if ( start == 0 && (end == 0 || end == 86400) ) {
            $("[name=duration]").val(["continuous"]);
            updateTimeOptions("continuous");
        } else if ( start > 0 && (end == 0 || end == 86400) ) {
            $("[name=duration]").val(["start"]);
            updateTimeOptions("start");
        } else if ( start > 0 && end > 0 ) {
            $("[name=duration]").val(["period"]);
            updateTimeOptions("period");
        } else {
            updateTimeOptions($("[name=duration]:checked").val());
        }

        if ( period == SCHEDULE_PERIOD_DAILY ) {
            updateDayOptions("startday", "all");
        } else if ( period == SCHEDULE_PERIOD_WEEKLY ) {
            $("#startday").val(startm.format("dddd"));
            $("#endday").val(endm.format("dddd"));
        }
    });

</script>
