<div class="modal-dialog">
    <div class="modal-content">
        <div class="modal-header">
            <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
            <h4 class="modal-title">Schedule new test</h4>
        </div>

        <div class="modal-body">


<form class="form-horizontal" role="form">
        <!-- the current site and all groups it belongs to -->
        <div class="form-group">
            <label for="source" class="col-lg-3 control-label">
                Source
            </label>
            <div class="col-lg-9">
                <select class="form-control" id="source">
                    <option>${ampname}</option>
                    <!-- TODO make this a static input field if no mesh sources? -->
                    <tal:block tal:condition="mesh_sources">
                        <optgroup label="Groups including ${ampname}">
                        <option tal:repeat="source mesh_sources" value="${source.name}">${source.longname}</option>
                    </tal:block>
                </select>
            </div>
        </div>

        <!-- destination meshes as well as individuals -->
        <!-- type in destinations as well as select boxes -->
        <div class="form-group">
            <label for="destination" class="col-lg-3 control-label">
                Destination
            </label>
            <div class="col-lg-8">
                <div class="radio">
                    <label>
                        <input type="radio" name="dest_type" value="destitem" checked onclick="updateDestinations(this.value)">
                        </input>
                    </label>
                    <select class="form-control" id="destitem" onclick="updateDestinations(this.id)">
                        <option disabled selected>Select destination...</option>
                        <optgroup label="Single Destination">
                        <option tal:repeat="target single_targets" value=${target.ampname} >${target.longname} (${target.ampname})</option>
                        <optgroup label="Multiple Destination">
                        <option tal:repeat="target mesh_targets" value="${target.name}" >${target.longname}</option>
                    </select>
                </div>
                <div class="radio">
                    <label>
                        <input type="radio" name="dest_type" value="deststring" onclick="updateDestinations(this.value)">
                        </input>
                    </label>
                    <input type=text class="form-control" id="deststring" placeholder="www.example.org" onclick="updateDestinations(this.id)" onchange="this.onclick();" onkeyup="this.onclick();" onpaste="this.onclick();" oninput="this.onclick();" />
                </div>
            </div>
        </div>




        <!-- TEST OPTIONS - mostly using per-test macros from other files -->
        <div class="form-group" style="border-top: 1px solid #e5e5e5;" id="test_options">
                &nbsp;

            <div class="form-group">
                <label for="test" class="col-lg-3 control-label">
                   Test Type
                </label>
                <div class="col-lg-8">
                    <select class="form-control" id="test" onchange="updateTestOptions(this.value)">
                        <option value="icmp" selected>ICMP Latency</option>
                        <option value="tcpping">TCP Latency</option>
                        <option value="dns">UDP DNS Latency</option>
                        <option value="traceroute">UDP Traceroute</option>
                        <option value="throughput">TCP Throughput</option>
                        <option value="http">HTTP</option>
                    </select>
                </div>
            </div>

            <!-- add all the inputs for parameters for each of the tests -->
            <div tal:repeat="test test_macros">
                <div metal:use-macro="test_macros[test].test_params"></div>
            </div>

        </div>


        <!-- SCHEDULE OPTIONS -->
        <div class="form-group" style="border-top: 1px solid #e5e5e5;">
        </div>

        <div class="form-group">
            <label for="frequency_count" class="col-lg-3 control-label">
                Frequency
            </label>
            <div class="col-lg-2">
                <p class="form-control-static">Every</p>
            </div>
            <div class="col-lg-2">
                <input type=text class="form-control" id="frequency_count" value=60 />
            </div>
            <div class="col-lg-3">
                <select class="form-control" id="frequency_type">
                    <option>seconds</option>
                    <option>minutes</option>
                    <option>hours</option>
                    <option>days</option>
                </select>
            </div>
        </div>

        <div class="form-group">
            <label for="duration" class="col-lg-3 control-label">
                Run Test
            </label>

            <div class="col-lg-7">
                <div class="radio">
                    <label>
                        <input type="radio" name="duration" id="continuous" value="continuous" onclick="updateTimeOptions(this.value)" checked>
                            Continuously
                        </input>
                    </label>
                </div>
                <div class="radio">
                    <label>
                        <input type="radio" name="duration" id="period" value="period" onclick="updateTimeOptions(this.value)">
                            Only during a specified period
                        </input>
                    </label>
                </div>
            </div>
        </div>

        <div class="form-group" id="start_block">
            <label for="datetimepicker_start" class="col-lg-3 control-label" id="start_label">
               Start
            </label>
            <div class="col-lg-4">
                <div class='input-group date' id='datetimepicker_start'>
                    <input type='text' class="form-control" data-date-format="HH:mm:ss" />
                    <span class="input-group-addon"><span class="glyphicon glyphicon-time"></span>
                    </span>
                </div>
            </div>
            <div class="col-lg-3">
                <select class="form-control" id="startday" onchange="updateDayOptions(this.id, this.value)">
                    <option value="all">every day</option>
                    <option>Monday</option>
                    <option>Tuesday</option>
                    <option>Wednesday</option>
                    <option>Thursday</option>
                    <option>Friday</option>
                    <option>Saturday</option>
                    <option>Sunday</option>
                </select>
            </div>
        </div>

        <div class="form-group" id="end_block">
            <label for="foo" class="col-lg-3 control-label">
               End
            </label>
            <div class="col-lg-4">
                <div class='input-group date' id='datetimepicker_end'>
                    <input type='text' class="form-control" data-date-format="HH:mm:ss" />
                    <span class="input-group-addon"><span class="glyphicon glyphicon-time"></span>
                    </span>
                </div>
            </div>
            <div class="col-lg-3">
                <select class="form-control" id="endday" onchange="updateDayOptions(this.id, this.value)">
                    <option value="all">every day</option>
                    <option>Monday</option>
                    <option>Tuesday</option>
                    <option>Wednesday</option>
                    <option>Thursday</option>
                    <option>Friday</option>
                    <option>Saturday</option>
                    <option>Sunday</option>
                </select>
            </div>
        </div>

</form>


        </div>

        <div class="modal-footer">
            <button type="button" class="btn btn-default" data-dismiss="modal">
                Discard changes
            </button>
            <button type="button" id="submit" class="btn btn-primary" onclick="submit(0);" disabled>Schedule new test</button>
        </div>
    </div><!-- /.modal-content -->
</div><!-- /.modal-dialog -->


<script type="text/javascript">
    /*
     * Set all default states for input etc. Still don't appear to be able
     * to use any of the bootstrap modal shown/loaded events to do this...
     */
    $(function () {

        ampname = "${ampname}";
        destination_meshes = [];
        destination_sites = [];
        schedule_args = undefined;

        $('#datetimepicker_start').datetimepicker({
            pickDate: false,
            defaultDate: "00:00:00",
            useSeconds: true
        });

        $('#datetimepicker_end').datetimepicker({
            pickDate: false,
            defaultDate: "00:00:00",
            useSeconds: true
        });

        updateTestOptions($("#test option:selected").val());
        updateTimeOptions($("[name=duration]:checked").val());
    });
</script>
